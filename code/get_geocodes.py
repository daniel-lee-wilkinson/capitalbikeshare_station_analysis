import pandas as pd
from geopy.geocoders import Nominatim
from time import sleep
from pathlib import Path

# üîß File paths
root = Path(__file__).resolve().parents[1]  # one level above /code
out_path = root / "processed_data" / "geocoded_employers.csv"
out_path.parent.mkdir(parents=True, exist_ok=True)  # create folder if needed

# Washington DC's 200 top employers in 2024 (https://does.dc.gov/sites/default/files/dc/sites/does/publication/attachments/Top%20200%20Employers-20241%28FINAL%29.xlsx)
companies = [
    "GEORGETOWN UNIVERSITY",
    "CHILDREN'S NATIONAL MEDICAL CENTER",
    "WASHINGTON HOSPITAL CENTER",
    "GEORGE WASHINGTON UNIVERSITY",
    "GEORGETOWN UNIVERSITY HOSPITAL",
    "AMERICAN UNIVERSITY",
    "UNIVERSAL PROTECTION SERVICE LLC",
    "BOOZ ALLEN & HAMILTON INC.",
    "HOWARD UNIVERSITY",
    "INSPERITY PEO SERVICES LP",
    "MEDSTAR MEDICAL GROUP LLC",
    "GEORGE WASHINGTON UNIVERSITY HOSPITAL",
    "SIBLEY MEMORIAL HOSPITAL",
    "RED COATS",
    "CATHOLIC UNIVERSITY OF AMERICA",
    "JUSTWORKS EMPLOYMENT GROUP LLC",
    "MONUMENTAL SPORTS",
    "HOWARD UNIVERSITY HOSPITAL",
    "DELOITTE CONSULTING LLP",
    "WHOLE FOODS MARKET GROUP INC.",
    "ARAMARK CAMPUS LLC",
    "KIPP DC/KEY ACADEMY",
    "THE GW MEDICAL FACULTY ASSOCIATES",
    "THE WASHINGTON POST",
    "SAFEWAY GROCERY STORES",
    "MARRIOTT HOTEL SERVICES, INCORPORATED",
    "TRINET HR CORP",
    "GALLAUDET UNIVERSITY",
    "DC WATER & SEWER AUTHORITY (DCWASA)",
    "ARCHDIOCESE OF WASHINGTON",
    "PARAGON SYSTEMS, INC.",
    "SECURITY ASSURANCE MANAGEMENT INC.",
    "COVINGTON & BURLING LLP",
    "PRICEWATERHOUSE COOPERS PUBLIC SECTOR",
    "NATIONAL ACADEMY OF SCIENCES",
    "MCKINSEY & COMPANY INC.",
    "FRIENDSHIP PUBLIC CHARTER SCHOOL",
    "DISTRICT OF COLUMBIA CVS PHARMACY",
    "AARP",
    "WALMART ASSOCIATES INC.",
    "SCIENCE APPLICATIONS INTERNATIONAL",
    "COMPASS GROUP USA, INC.",
    "HILTON HOTEL EMPLOYER, LLC",
    "KPMG PEAT MARWICK",
    "GENERAL DYNAMICS INFORMATION TECHNOLOGY",
    "CHEMONICS INTERNATIONAL",
    "UNITY HEALTH CARE, INC.",
    "NATIONAL REHABILITATION HOSPITAL INC.",
    "POTOMAC ELECTRIC POWER COMPANY (PEPCO)",
    "HYATT CORPORATION",
    "DISTRICT OF COLUMBIA HOUSING AUTHORITY",
    "PAE SHARED SERVICES LLC",
    "INTEGRATED COMMUNITY SERVICES INC",
    "GOOGLE LLC",
    "GIANT FOOD STORE GIANT PHARMACY",
    "JOHNS HOPKINS UNIVERSITY",
    "LEIDOS INNOVATIONS CORPORATION",
    "CHASE MANHATTAN BANK",
    "MBI HEALTH SERVICES LLC",
    "UNIVERSAL SERVICE ADMINISTRATION CO.",
    "S D H EDUCATION EAST LLC",
    "NATIONAL PUBLIC RADIO",
    "ACCENTURE NATIONAL SECURITY SERVICE",
    "INTER-CON SECURITY SYSTEMS, INC.",
    "ASSOCIATION OF AMERICAN MEDICAL COLLEGES",
    "COLONIAL PARKING",
    "PROTESTANT EPISCOPAL CATHEDRAL FOUNDATION",
    "STARBUCKS COFFEE CORP",
    "FORT MYER CONSTRUCTION CORP",
    "MARYS CTR FOR MATERNAL & CHILD CARE",
    "NBC UNIVERSAL MEDIA LLC",
    "RENAISSANCE HOTEL OPERATING CO.",
    "IBM CORPORATION",
    "CARLYLE GROUP",
    "HOGAN LOVELLS US LLP",
    "BOZZUTO GROUP",
    "TRADER JOE'S EAST, INC.",
    "ARNOLD & PORTER KAYE SCHOLER LLP",
    "CACI INC FEDERAL",
    "LATHAM AND WATKINS",
    "TRIPLE CANOPY",
    "EAB",
    "UNITED MEDICAL CENTER",
    "PEW CHARITABLE TRUSTS",
    "GUIDEHOUSE, INC.",
    "PALANTIR TECHNOLOGIES INC.",
    "CHIPOTLE RESTAURANTS",
    "KAISER HEALTH PLAN",
    "COSTAR GROUP",
    "VADOR VENTURES INC.",
    "WILLIAMS & CONNOLLY LLP",
    "WASHINGTON NATIONALS BASEBALL",
    "THE BOSTON CONSULTING GROUP INC.",
    "AMERICAN PSYCHOLOGICAL ASSOCIATION",
    "FACEBOOK",
    "SFI-WHELAN SECURITY LLC",
    "TURNER SERVICES, INC.",
    "LEVY PREMIUM FOODSERVICE",
    "RESTAURANT ASSOCIATES OF NY LLC",
    "TATTE BAKERY & CAF√â",
    "AMERICAN CHEMICAL SOCIETY",
    "CAPITAL CARE INC.",
    "VENABLE, BAETJER, & HOWARD, INC.",
    "BUSY BEE ENVIRONMENTAL SERVICE",
    "BELTWAY CLEANING SERVICES DC LLC",
    "JONES LANS LASAILE AMERICAS, INC.",
    "S D H SERVICES EAST LLC",
    "NATIONAL GEOGRAPHIC SOCIETY",
    "CROWELL & MORING",
    "TARGET CORPORATION",
    "MORGAN LEWIS & BOCKIUS LLP",
    "NATIONAL GEOGRAPHIC PARTNERS LLC",
    "THE URBAN INSTITUTE",
    "FANNIE MAE",
    "ADP TOTALSOURCE FL XI INC.",
    "M C DEAN INC.",
    "WORLD WILDLIFE FUND/CONSERVATION FOUNDATION",
    "SERCO INC.",
    "SIRIUS XM RADIO, INC.",
    "GLOBAL TAPAS LLC",
    "HAMPTON INN WASHINGTON DC",
    "CREDENCE MANAGEMENT SOLUTIONS, LLC.",
    "ERNST & YOUNG US LLP",
    "COMMUNITY OF HOPE INC.",
    "CGI FEDERAL, INC.",
    "WORLD RESOURCES INSTITUTE",
    "T & N RELIABLE NURSING CARE",
    "PWC US TAX LLP",
    "TRINITY COLLEGE",
    "NATIONAL EDUCATION ASSOCIATION",
    "CENTERRA GROUP LLC",
    "WILMER, CUTLER, PICKERING, HALE, & DORR LLP",
    "AKIN, GUMP, STRAUSS, HAUER, & FELD LLP",
    "MELWOOD HORTICULTURAL",
    "SO OTHERS MIGHT EAT, INC. (SOME)",
    "PHI SERVICE CO.",
    "MIDTOWN PERSONNEL, INC.",
    "AMERICAN COLLEGE OF CARDIOLOGY FOUNDATION",
    "RITZ CARLTON HOTEL LLC",
    "CAPITOL PAVING OF DC",
    "UNITED PLANNING ORGANZATION, INC.",
    "BROOKINGS INSTITUTION",
    "NATIONAL DEMOCRATIC FOR INT'L AFFAIRS",
    "SP PLUS CORPORATON",
    "UG2 LLC",
    "CASSIDY TURLEY COMMERCIAL REAL ESTATE",
    "BANK OF AMERICA NORTH AMERICA",
    "F S WASHINGTON EMPLOY INC.",
    "INTERNATIONAL REPUBLICAN INSTITUTE",
    "DC PREPARATORY ACADEMY",
    "OMNI HOTELS",
    "US CHAMBER OF COMMERCE",
    "CACI INC-COMMERCIAL",
    "WASHINGTON CONVENTION CENTER",
    "AYA HEALTHCARE SERVICES INC.",
    "ABA HOME HEALTH CARE",
    "OPTUM SERVICES, INC.",
    "INNOVATIVE LIFE SOLUTIONS, INC.",
    "ECS FEDERAL INC.",
    "ARAMARK FACILITY SERVICE LLC",
    "M ARTHUR GENSLER JR & ASSOCIATES, INC.",
    "CHIMES DISTRICT OF COLUMBIA, INC.",
    "WALDEN SECURITY",
    "LIFE LINE, INC.",
    "HERITAGE FOUNDATION",
    "ADP TOTALSOURCE CO XXI INC.",
    "HARRIS TEETER LLC",
    "COSTCO WHOLESALE CORPORATION",
    "CBRE",
    "FOX NEWS NETWORK LLC",
    "M B FINNEGAN D B HENDERSON ETAL.",
    "ASPEN INSTITUTE FOR HUMANISTIC STUDIES",
    "WEGMANS FOOD MARKETS, INC.",
    "BANK FUND STAFF FEDERAL CREDIT UNION",
    "PUBLIC COMPANY ACCOUNTING OVERSIGHT BOARD",
    "APPLE INC.",
    "PNC BANK NORTH AMERICA",
    "AMER ASSOC FOR THE ADVANCEMENT OF SCIENCE",
    "BAKER CONCRETE CONSTRUCTION INC.",
    "SIDLEY AUSTIN LLP",
    "RADIO FREE ASIA",
    "COOLEY LLP",
    "STERNE KESSLER GOLDSTEIN & FOX",
    "EQUINOX GYMS",
    "P & R ENTEPRISES INC.",
    "GIBSON DUNN & CRUTCHER",
    "J&B CLEANING SERVICES",
    "WHITMAN-WALKER CLINIC",
    "WELLS FARGO BANK NORTH AMERICA",
    "CRS FACILITIES SERVICES LLC",
    "ABM INDUSTRY GROUPS, LLC",
    "SEC TEK SECURITY INC.",
    "SKADDEN, ARPS, SLATE, MEAGHER, & FLOM LLP",
    "PWC US GROUP LLP",
    "MCDERMOTT WILL & EMERY",
    "STEPTOE & JOHNSON",
    "FUTURES GROUP",
    "CONRAD EMPLOYER, LLC"
]


# üåê Nominatim setup
geolocator = Nominatim(user_agent="employer_mapper")
results = []

# üîÅ Geocode loop
for name in companies:
    try:
        location = geolocator.geocode(f"{name}, Washington DC", timeout=10)
        if location:
            results.append({"name": name, "lat": location.latitude, "lon": location.longitude})
            print(f"‚úÖ {name} ‚Üí {location.latitude:.4f}, {location.longitude:.4f}")
        else:
            print(f"‚ö†Ô∏è Not found: {name}")
            results.append({"name": name, "lat": None, "lon": None})
    except Exception as e:
        print(f"‚ùå Error for {name}: {e}")
        results.append({"name": name, "lat": None, "lon": None})
    sleep(1)  # respect OpenStreetMap rate limits

# üíæ Save to CSV
df = pd.DataFrame(results)
df.to_csv(out_path, index=False)
print(f"\n‚úÖ Geocoded employer list saved to: {out_path}")
